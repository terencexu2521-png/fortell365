name: Fortell365 SEO è‡ªåŠ¨åŒ–ç³»ç»Ÿ

on:
  # å®šæ—¶ä»»åŠ¡ï¼šæ¯å¤©è‡ªåŠ¨æ‰§è¡Œ
  schedule:
    - cron: '0 2 * * *'  # æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
    inputs:
      count:
        description: 'ç”Ÿæˆæ–‡ç« æ•°é‡'
        required: false
        default: '30'
        type: string

jobs:
  generate-seo-content:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»“åº“ä»£ç 
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.FORTELL365_PAT }}
        fetch-depth: 0
        
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        
    - name: ç”ŸæˆSEOå†…å®¹
      run: |
        # åˆ›å»ºè¾“å‡ºç›®å½•
        mkdir -p public/seo
        
        # ç”ŸæˆæŒ‡å®šæ•°é‡çš„æ–‡ç« 
        python generate_seo_content.py
        
    - name: æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶
      run: |
        echo "ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶åˆ—è¡¨ï¼š"
        ls -la seo_pages/
        
    - name: ç§»åŠ¨æ–‡ä»¶åˆ°ç½‘ç«™ç›®å½•
      run: |
        if [ -d "seo_pages" ]; then
          cp seo_pages/*.html public/seo/
          echo "âœ… æ–‡ä»¶å·²ç§»åŠ¨åˆ° public/seo/"
          ls -la public/seo/
        else
          echo "âŒ æœªæ‰¾åˆ°ç”Ÿæˆçš„æ–‡ä»¶ï¼"
          exit 1
        fi
        
    - name: åˆ›å»ºéƒ¨ç½²æ‘˜è¦
      run: |
        echo "# Fortell365 SEO å†…å®¹éƒ¨ç½²æŠ¥å‘Š" > deployment_summary.md
        echo "" >> deployment_summary.md
        echo "ğŸ“… ç”Ÿæˆæ—¶é—´: $(date)" >> deployment_summary.md
        echo "ğŸ¤– æ‰§è¡Œæ–¹å¼: ${{ github.event_name }}" >> deployment_summary.md
        echo "" >> deployment_summary.md
        
        if [ -d "public/seo" ]; then
          echo "## ğŸ“‹ ç”Ÿæˆçš„æ–‡ä»¶åˆ—è¡¨" >> deployment_summary.md
          ls -la public/seo/*.html | while read line; do
            filename=$(basename "$line")
            echo "- $filename" >> deployment_summary.md
          done
          echo "" >> deployment_summary.md
          echo "ğŸŒ è®¿é—®åœ°å€: https://fortell365.com/seo/" >> deployment_summary.md
        fi
        
        echo "ğŸ“Š éƒ¨ç½²æ‘˜è¦ï¼š"
        cat deployment_summary.md
        
    - name: æäº¤å¹¶æ¨é€å˜æ›´
      uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: |
          ğŸ¤– è‡ªåŠ¨ç”ŸæˆSEOå†…å®¹ - ${{ github.event_name == 'schedule' && 'å®šæ—¶ä»»åŠ¡' || 'æ‰‹åŠ¨è§¦å‘' }}
          
          ğŸ“… ç”Ÿæˆæ—¶é—´: $(date)
          ğŸ“ æ–‡ç« æ•°é‡: ${{ github.event.inputs.count || '30' }}
          ğŸ¯ æ‰§è¡Œæ–¹å¼: ${{ github.event_name }}
          
          ğŸ“‹ æ–°å¢æ–‡ä»¶:
          ${{ steps.changes.outputs.all_changed_files || 'æ–°å¢SEOé¡µé¢' }}
        branch: main
        commit_author_name: "Fortell365 Bot"
        commit_author_email: "bot@fortell365.com"
        
    - name: ä¸Šä¼ éƒ¨ç½²æŠ¥å‘Š
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: seo-deployment-report
        path: |
          seo_pages/
          deployment_summary.md
        retention-days: 7

  notify-success:
    needs: generate-seo-content
    runs-on: ubuntu-latest
    if: success()
    
    steps:
    - name: ä¸‹è½½éƒ¨ç½²æŠ¥å‘Š
      uses: actions/download-artifact@v3
      with:
        name: seo-deployment-report
        path: ./
        
    - name: æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
      run: |
        echo "ğŸ‰ SEOå†…å®¹ç”ŸæˆæˆåŠŸï¼"
        echo ""
        echo "ğŸ“Š éƒ¨ç½²è¯¦æƒ…ï¼š"
        cat deployment_summary.md
        echo ""
        echo "ğŸŒ ç«‹å³è®¿é—®: https://fortell365.com/seo/"

  notify-failure:
    needs: generate-seo-content
    runs-on: ubuntu-latest
    if: failure()
    
    steps:
    - name: æ˜¾ç¤ºå¤±è´¥é€šçŸ¥
      run: |
        echo "âŒ SEOå†…å®¹ç”Ÿæˆå¤±è´¥ï¼"
        echo ""
        echo "ğŸ”§ è¯·æ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š"
        echo "1. æ£€æŸ¥ GitHub Actions æ‰§è¡Œæ—¥å¿—"
        echo "2. ç¡®è®¤ FORTELL365_PAT Secret å·²æ­£ç¡®è®¾ç½®"
        echo "3. æ£€æŸ¥ generate_seo_content.py æ–‡ä»¶æ˜¯å¦å­˜åœ¨"
