name: SEO Automation

on:
  schedule:
    - cron: '0 2 * * *'
  workflow_dispatch:
    inputs:
      count:
        description: 'Number of articles to generate'
        required: false
        default: '30'
        type: string

jobs:
  generate-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install --no-cache-dir -r requirements.txt
        
    - name: Generate SEO content
      run: |
        mkdir -p public/seo
        mkdir -p seo_pages
        python generate_seo_content.py
        
        FILE_COUNT=$(ls seo_pages/*.html 2>/dev/null | wc -l)
        echo "ç”Ÿæˆæ–‡ä»¶æ•°é‡: $FILE_COUNT"
        
        if [ $FILE_COUNT -eq 0 ]; then
          echo "âŒ æ²¡æœ‰ç”Ÿæˆæ–‡ä»¶"
          exit 1
        fi
        
        cp seo_pages/*.html public/seo/
        echo "âœ… æ–‡ä»¶å¤åˆ¶å®Œæˆ"
        
    - name: Commit and push
      run: |
        git config --global user.name "Fortell365 Bot"
        git config --global user.email "bot@fortell365.com"
        
        git add public/seo/
        
        if git diff --cached --quiet; then
          echo "æ²¡æœ‰å˜æ›´"
          exit 0
        fi
        
        FILE_COUNT=$(ls seo_pages/*.html 2>/dev/null | wc -l)
        git commit -m "ğŸ¤– SEO content - $FILE_COUNT files"
        git push origin main
        echo "âœ… å·²æ¨é€åˆ°GitHub"
